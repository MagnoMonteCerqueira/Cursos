<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.0</version>
    <date>2022-07-01T05:28:57Z</date>
    <groups>
        <group>
            <uuid>56319b9a00164b24abad1a11bb8e96fe</uuid>
            <name>Hosts/KSC</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>4547cadda10b4c33ae5f0f308cd7939b</uuid>
            <template>Template_KSC_13_Implantacao_ODBC_versao-0.0.1</template>
            <name>Template_KSC_13_Implantacao_ODBC_versao-0.0.1</name>
            <groups>
                <group>
                    <name>Hosts/KSC</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>7bf8c092cc674e56ae633502bd80c31b</uuid>
                    <name>01.01- Agente de Rede instalado</name>
                    <type>DEPENDENT</type>
                    <key>Agente.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.wstrNagentBuild &gt; '0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>61c6664502304b9fbe4d7523044b9283</uuid>
                    <name>01.02- Agente de Rede não instalado</name>
                    <type>DEPENDENT</type>
                    <key>Agente.nao.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.wstrNagentBuild =='0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5809a2d6ea5145f3ba989d7205622f7d</uuid>
                    <name>02.01- O aplicativo de segurança instalado</name>
                    <type>DEPENDENT</type>
                    <key>Aplicativo.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.wstrAvBuild &gt; '0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>efb93398667944f1b410509ba24df9e2</uuid>
                    <name>02.02- O aplicativo de segurança não esta instalado</name>
                    <type>DEPENDENT</type>
                    <key>Aplicativo.nao.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.wstrAvBuild =='0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>63b0ee8703da4e60a5a022938d77c779</uuid>
                    <name>04.01- O Database instalado</name>
                    <type>DEPENDENT</type>
                    <key>db.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.tmAvBasesDate &gt; '0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e0eac4e00cbf44c2bef1324553703a69</uuid>
                    <name>04.02- O Database não esta instalado</name>
                    <type>DEPENDENT</type>
                    <key>db.nao.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.tmAvBasesDate =='0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bf72d1d2713b4349b8ea26efc19a0cce</uuid>
                    <name>00- Descoberta global raw Dispositivos</name>
                    <type>ODBC</type>
                    <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    <delay>30s</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <params>SELECT 

kavhosts.nId,kavhosts.strWinHostName,kavhosts.nStatus,kavhosts.nLastRtpState,kavhosts.nOSName,kavhosts.nLastFullScan,kavhosts.nGroup,
DATEDIFF(day, kavhosts.tmLastHeartbeat, GETDATE()) AS 'diassemcomunicacao',

kavosname.wstrOSName,

kavhoststatus.nLastStatus,

kavhostav.wstrNagentBuild,kavhostav.wstrAvBuild,kavhostav.tmAvBasesDate,

kavavbase.bHasInactualAvBases,

kavhostsgroup.wstrName,kavhostsgroup.txtFullname,

kavhostscompstatus.nAntiSpamStatus,kavhostscompstatus.nDlpStatus,kavhostscompstatus.nCollabSrvsProtStatus,kavhostscompstatus.nEmailAvStatus,kavhostscompstatus.nEdrStatus


FROM [KAV].[dbo].[Hosts] as kavhosts

INNER JOIN [KAV].[dbo].[hst_os_name] as kavosname ON kavosname.nId = kavhosts.nOSName

INNER JOIN [KAV].[dbo].[hst_host_status] as kavhoststatus ON kavhoststatus.nId = kavhosts.nId

INNER JOIN [KAV].[dbo].[v_hst_prdstates_grp] as kavhostav ON kavhostav.nHostId = kavhosts.nId

INNER JOIN [KAV].[dbo].[v_hst_avbases_inactual] as kavavbase ON kavavbase.nId = kavhosts.nId

INNER JOIN [KAV].[dbo].[AdmGroups] as kavhostsgroup ON kavhostsgroup.nId = kavhosts.nGroup

INNER JOIN [KAV].[dbo].[v_hst_prod_comp_status] as kavhostscompstatus ON kavhostscompstatus.nHostId = kavhosts.nId

WHERE kavhosts.nOSName NOT IN ('0')</params>
                    <username>{$USERNAME}</username>
                    <password>{$PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>null</parameter>
                                <parameter>0</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <tags>
                        <tag>
                            <tag>Descobertas globais raw</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>77cbfdd154ad4e5398c24f661065babe</uuid>
                    <name>03.01- O EDR instalado</name>
                    <type>DEPENDENT</type>
                    <key>Edr.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.nEdrStatus &gt; '0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>a380d832400a41d09e3ea4dc06118024</uuid>
                    <name>03.02- O EDR não esta instalado</name>
                    <type>DEPENDENT</type>
                    <key>Edr.nao.instalado</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.nEdrStatus =='0')].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>8a60e8fefa1e4facb89c1747c5b064a0</uuid>
                    <name>00- Total de dispositivos</name>
                    <type>DEPENDENT</type>
                    <key>Total.dispositivos</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[?(@.strWinHostName)].length()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Informações de Implementação</tag>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>94e36051430c418aa8ace0789d51c7e0</uuid>
                    <name>01-   No Agent Deployment</name>
                    <type>DEPENDENT</type>
                    <key>No.Agent.Deployment.Status</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#AGENT}</macro>
                                <value>^0$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>0d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>51494aacde6c4544a67d18d14ffea144</uuid>
                            <name>{#PC.NAME}</name>
                            <type>DEPENDENT</type>
                            <key>No.Agent.Deployment.Status.[&quot;{#PC.NAME}&quot;]</key>
                            <delay>0</delay>
                            <valuemap>
                                <name>No Agent Deployment</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.strWinHostName == '{#PC.NAME}')].wstrNagentBuild.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>No Agent Deployment</tag>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>output = JSON.parse(value).map(function(net){
    return {
        &quot;{#PC.OS}&quot;: net.nOSName,
        &quot;{#PC.NAME}&quot;: net.strWinHostName,
        &quot;{#AGENT}&quot;: net.wstrNagentBuild
    }})
return JSON.stringify({&quot;data&quot;: output})</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>6191c89ec2a34190b268583168509c9e</uuid>
                    <name>02-  No AV Deployment</name>
                    <type>DEPENDENT</type>
                    <key>No.AV.Deployment.Status</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#AV}</macro>
                                <value>^0$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>0d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>1883a618e1654767b353ea81cf75d0cd</uuid>
                            <name>{#PC.NAME}</name>
                            <type>DEPENDENT</type>
                            <key>No.AV.Deployment.Status.[&quot;{#PC.NAME}&quot;]</key>
                            <delay>0</delay>
                            <valuemap>
                                <name>No AV Deployment</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.strWinHostName == '{#PC.NAME}')].wstrAvBuild.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>No AV Deployment</tag>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>output = JSON.parse(value).map(function(net){
    return {
        &quot;{#PC.OS}&quot;: net.nOSName,
        &quot;{#PC.NAME}&quot;: net.strWinHostName,
        &quot;{#AV}&quot;: net.wstrAvBuild
    }})
return JSON.stringify({&quot;data&quot;: output})</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>b06a64f5418a41c4abc54e66a10efae3</uuid>
                    <name>04-  No Database Deployment</name>
                    <type>DEPENDENT</type>
                    <key>No.Database.Deployment.Status</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#DATABASE}</macro>
                                <value>^0$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>0d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>110b9f61400d4657909c981ce6cd9505</uuid>
                            <name>{#PC.NAME}</name>
                            <type>DEPENDENT</type>
                            <key>No.database.Deployment.Status.[&quot;{#PC.NAME}&quot;]</key>
                            <delay>0</delay>
                            <valuemap>
                                <name>No Database  Deployment</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.strWinHostName == '{#PC.NAME}')].tmAvBasesDate.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>No database update deployment</tag>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>output = JSON.parse(value).map(function(net){
    return {
        &quot;{#PC.OS}&quot;: net.nOSName,
        &quot;{#PC.NAME}&quot;: net.strWinHostName,
        &quot;{#DATABASE}&quot;: net.tmAvBasesDate
    }})
return JSON.stringify({&quot;data&quot;: output})</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>338a54e113c24e6db3e68289a27d1971</uuid>
                    <name>03-  No EDR Deployment</name>
                    <type>DEPENDENT</type>
                    <key>No.EDR.Deployment.Status</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#EDR}</macro>
                                <value>^0$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>0d</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>b51f165b400843abb282d01615a7f1e1</uuid>
                            <name>{#PC.NAME}</name>
                            <type>DEPENDENT</type>
                            <key>No.EDR.Deployment.Status.[&quot;{#PC.NAME}&quot;]</key>
                            <delay>0</delay>
                            <valuemap>
                                <name>No EDR Deployment</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.strWinHostName == '{#PC.NAME}')].nEdrStatus.first()</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>No EDR Deployment</tag>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>db.odbc.get[Descoberta-raw-hosts-implantacao,{$BANCO_DADOS}]</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>output = JSON.parse(value).map(function(net){
    return {
        &quot;{#PC.OS}&quot;: net.nOSName,
        &quot;{#PC.NAME}&quot;: net.strWinHostName,
        &quot;{#EDR}&quot;: net.nEdrStatus
    }})
return JSON.stringify({&quot;data&quot;: output})</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$BANCO_DADOS}</macro>
                    <value>KSC</value>
                </macro>
                <macro>
                    <macro>{$PASSWORD}</macro>
                    <value>zabbix</value>
                </macro>
                <macro>
                    <macro>{$USERNAME}</macro>
                    <value>zabbix</value>
                </macro>
            </macros>
            <valuemaps>
                <valuemap>
                    <uuid>d982a7496154411381357f0c85c149b7</uuid>
                    <name>No Agent Deployment</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>No Agent Deployment</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>a5f830079fe44c51966db1a124fd9598</uuid>
                    <name>No AV Deployment</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>Not AV installed</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>c327c80d42f1444a8370ccc5a61a107a</uuid>
                    <name>No Database  Deployment</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>No Database Deployment</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>b50f6e377bee4054a802a9b4eda8cdb3</uuid>
                    <name>No EDR Deployment</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>No EDR Deployment</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
</zabbix_export>
